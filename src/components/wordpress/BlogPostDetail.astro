---
// This component renders a full WordPress blog post
// It's used on individual blog post pages

import { formatDate, getFeaturedImageUrl, sanitizeContent } from '@/utils/wordpress';

interface Props {
  post: any;
}

const { post } = Astro.props;

const title = post.title.rendered;
const content = sanitizeContent(post.content.rendered);
const date = formatDate(post.date);
const featuredImage = getFeaturedImageUrl(post, 'large');

// Extract author name if available
const authorName = post._embedded?.author?.[0]?.name || 'Unknown Author';
const authorAvatar = post._embedded?.author?.[0]?.avatar_urls?.['96'] || null;

// Extract categories if available
const categories = post._embedded?.['wp:term']?.[0] || [];
---

<article class="prose prose-lg dark:prose-invert mx-auto max-w-3xl">
  <header class="mb-8">
    <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold font-display leading-tight mb-6">
      {title}
    </h1>
    
    <div class="flex items-center gap-4 mb-6">
      {authorAvatar && (
        <img 
          src={authorAvatar}
          alt={authorName}
          class="w-10 h-10 rounded-full"
        />
      )}
      
      <div>
        <div class="font-medium">{authorName}</div>
        <div class="text-sm text-muted-foreground">{date}</div>
      </div>
    </div>
    
    {categories.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-8">
        {categories.map((category: any) => (
          <a 
            href={`/blog/category/${category.slug}`}
            class="text-xs font-medium px-3 py-1 rounded-full bg-primary/20 border border-primary/30 text-primary-foreground backdrop-blur-sm hover:bg-primary/30 transition-colors"
          >
            {category.name}
          </a>
        ))}
      </div>
    )}
    
    {featuredImage && (
      <div class="mb-8 rounded-lg overflow-hidden">
        <img 
          src={featuredImage}
          alt={title}
          class="w-full h-auto"
        />
      </div>
    )}
  </header>
  
  <div class="wp-content" set:html={content} />
</article>

<style is:global>
  /* 
   * These styles help WordPress content fit better with your Astro styling
   * You may need to adjust these based on your specific WordPress content
   */
  .wp-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
  }
  
  .wp-content figure {
    margin: 2rem 0;
  }
  
  .wp-content figure figcaption {
    text-align: center;
    font-size: 0.875rem;
    color: var(--color-muted-foreground);
    margin-top: 0.5rem;
  }
  
  .wp-content .wp-block-quote {
    border-left: 4px solid var(--color-primary);
    padding-left: 1.5rem;
    font-style: italic;
    margin: 2rem 0;
  }
  
  .wp-content .wp-block-code {
    background-color: var(--color-card);
    padding: 1rem;
    border-radius: 0.5rem;
    font-family: monospace;
    overflow-x: auto;
  }
</style>